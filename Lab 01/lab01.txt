CREATE TABLE REGIONS(region_id SMALLINT PRIMARY KEY,
region_name VARCHAR(30) NOT NULL UNIQUE);

CREATE TABLE COUNTRIES(country_id SMALLINT PRIMARY KEY,
country_name VARCHAR(30) NOT NULL UNIQUE, 
region_id SMALLINT NOT NULL,
FOREIGN KEY(region_id) REFERENCES REGIONS(region_id) ON DELETE CASCADE);

CREATE TABLE LOCATIONS(location_id SMALLINT PRIMARY KEY,
street_address VARCHAR(50) NOT NULL,
postal_code VARCHAR(10) NOT NULL,
city VARCHAR(30) NOT NULL,
state_province VARCHAR(30) NOT NULL,
country_id SMALLINT NOT NULL,
FOREIGN KEY(country_id) REFERENCES COUNTRIES(country_id) ON DELETE CASCADE);

CREATE TABLE JOBS(job_id SMALLINT PRIMARY KEY,
job_title VARCHAR(20) NOT NULL,
min_salary FLOAT,
max_salary FLOAT,
CHECK(max_salary - min_salary >= 2000));

CREATE TABLE DEPARTMENTS(department_id SMALLINT PRIMARY KEY, 
department_name VARCHAR(50));

ALTER TABLE DEPARTMENTS ADD manager_id SMALLINT NOT NULL;

ALTER TABLE DEPARTMENTS MODIFY (department_name VARCHAR(50) NOT NULL);

ALTER TABLE DEPARTMENTS ADD location_id SMALLINT NOT NULL;

ALTER TABLE DEPARTMENTS ADD FOREIGN KEY(location_id) REFERENCES LOCATIONS(location_id) ON DELETE CASCADE;

CREATE table EMPLOYEES(employee_id SMALLINT PRIMARY KEY,
first_name VARCHAR(20) NOT NULL,
last_name VARCHAR(20) NOT NULL,
email VARCHAR(30) NOT NULL,
phone_number VARCHAR(20) NOT NULL,
hire_date DATE NOT NULL,
job_id SMALLINT NOT NULL,
salary FLOAT NOT NULL,
commission_pct FLOAT,
manager_id SMALLINT NOT NULL,
department_id SMALLINT NOT NULL
);

ALTER TABLE EMPLOYEES ADD FOREIGN KEY(job_id) REFERENCES JOBS(job_id) ON DELETE CASCADE;

ALTER TABLE EMPLOYEES ADD FOREIGN KEY(job_id) REFERENCES JOBS(job_id) ON DELETE CASCADE;

ALTER TABLE DEPARTMENTS ADD FOREIGN KEY(manager_id) REFERENCES EMPLOYEES(employee_id) ON DELETE CASCADE;

ALTER TABLE EMPLOYEES ADD FOREIGN KEY(manager_id) REFERENCES EMPLOYEES(employee_id) ON DELETE CASCADE;

CREATE TABLE JOB_HISTORY(employee_id SMALLINT,
start_date DATE,
end_date DATE,
job_id SMALLINT NOT NULL,
department_id SMALLINT NOT NULL,
PRIMARY KEY(employee_id, start_date),
FOREIGN KEY(job_id) REFERENCES JOBS(job_id) ON DELETE CASCADE,
FOREIGN KEY(department_id) REFERENCES DEPARTMENTS(department_id) ON DELETE CASCADE);

DROP TABLE JOB_HISTORY;

FLASHBACK TABLE JOB_HISTORY TO BEFORE DROP;
